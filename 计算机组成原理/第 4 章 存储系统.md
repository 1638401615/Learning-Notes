## 4.2 半导体存储器

### 静态MOS存储器

SRAM：

### 动态MOS存储器

* DRAM

  提高存储密度：

​		1. 去掉两个负载管

​		2. 增加两个电容缓存电荷

​		因此读会比SRAM更慢，还顺带充个电

​		读过程比写复杂、速度慢

* DRAM刷新

  定期补充电荷以避免电荷泄露引起的信息丢失

  1. 集中式刷新：在数据丢失之前刷新所有行，存在**死区**，在**实时要求不高**的场合使用

     <img src="./笔记图片/image-20220429143628429.png" alt="image-20220429143628429" style="zoom:80%;" />

  2. 分散刷新：读写+刷新   各刷新周期分散安排在存取周期中 用在低速系统

     <img src="./笔记图片/image-20220429143646430.png" alt="image-20220429143646430" style="zoom:80%;" />

  3. 异步刷新：每隔2ms/128=15.5微秒刷新一行,将128次刷新分散

     ​	<img src="./笔记图片/image-20220429143730808.png" alt="image-20220429143730808" style="zoom:80%;" />

  

  

### 只读存储器

## 4.3 主存的组织及与CPU的连接

* 存储器扩展
  1. 字长扩展（数据总线扩展）：各芯片并行工作
  2. 字数扩展（地址总线扩展）：同一时刻仅有一个芯片工作

## 4.5 高速缓冲存储器

<img src="./笔记图片/image-20220509102913544.png" alt="image-20220509102913544" style="zoom:67%;" />

#### 4.5.3 cache的基本概念

基本术语：

* hit , hit rate , hit time

* miss , miss rate , miss penalty(缺失损失)

* block：cache与主存交换的最小单位，大于等于CPU访问的地址（字），根据时间和空间局限性预取

* 行/槽 Line/Slot：标记，标志位，数据块容器

  搬运的是数据块副本，不是直接拿走数据，是复制了放到cache！

* Cold Cache ， Warm Cache

  cache刚开始使用的时候或者进程切换的时候cache没有有效数据，即为Cold Cache

  使用一段时间后有有效数据，即为Warm Cache

cache关键技术

* 数据查找

  主存地址 --> cache 地址 --> cache 数据

  建立查找表，将主存块号和cache块号的映射记录下来

  利用相联存储器实现**并行查找**

  相联存储器按内容进行访问，以关键字作全局**并发比较**，硬件成本高（比较器多），通常用于存放查找表或者全相联cache

  存储容量=查找表容量=表项数*表项大小

  <img src="./笔记图片/image-20220509104918180.png" alt="image-20220509104918180" style="zoom:67%;" />

  为了减少存储器表的大小，**直接继承块内偏移**，查找表表项内容(valic,主存块地址，cache块地址)，查找表项数目=cache数，减少存储大小

* 地址映射

  * 直接相联：放麻烦，找容易

    减少成本，冲突可能性增大

    <img src="./笔记图片/image-20220509113540130.png" alt="image-20220509113540130" style="zoom:67%;" />

  * 全相联：放容易，找麻烦

    成本高，冲突少

    <img src="./笔记图片/image-20220509113609975.png" alt="image-20220509113609975" style="zoom:67%;" />

  * 组相联：折中

    组内直接相联，组间全相联

    组内全相联，组间直接相连

    <img src="./笔记图片/image-20220509113759614.png" alt="image-20220509113759614" style="zoom:67%;" />

* 替换策略

  * 先进先出
  
  * 最近最不经常使用方法--LFU
  
    <img src="./笔记图片/image-20220513143740754.png" alt="image-20220513143740754" style="zoom:67%;" />
  
  * 近期最少使用法--LRU
  
    <img src="./笔记图片/image-20220513143758244.png" alt="image-20220513143758244" style="zoom:67%;" />
  
    优点：**使得计数器的计数位数变得有限，LFU会越计越多**
  
    缺点：有时候会误判（考前临时抱佛脚）
  
  * 随机替换法
  
* 写入策略

  * 写回法
  * 写穿法
  * 写分配
  * 写不分配

## 4.6 虚拟存储器

* 层次结构

  <img src="./笔记图片/image-20220513154709429.png" alt="image-20220513154709429" style="zoom:67%;" />

* 虚拟存储器本质：虚拟地址映射到内存和**磁盘**里面，提供一种有很大存储空间的假象
* 虚存机制由硬件软件协作实现
  * 进程及进程上下文切换、存储器分配
  * 虚拟地址空间管理、缺页处理
  * 存储器保护

与CPU Cache相同与差异

* 相同：

  将程序中常用的部分驻留在高速存储器

  数据的换入换出由硬件或操作系统完成，对用户透明
  充分利用程序局部性

* 差异：

  虚存用于扩大主存容量，cache用于加速主存性能

  虚存未命中性能损失远大于cache

  虚存由硬件和OS联合管理，cache由硬件管理